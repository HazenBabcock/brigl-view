<!doctype html>
<html lang="en">
  <head>
    <title>Brigl-View</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <style>
      body { background-color: #ccccff;	margin: 0px; font-family: Monospace; font-weight: bold; }
      div  { background-color: #ffffff; border:1px solid black; width:800px; height:600px; }
    </style>
  </head>
  
  <script src="js/three.min.js"></script>
  <script src="js/prototype.js"></script>
  <script src="js/Detector.js"></script>
  <script src="js/brigl_materials.js"></script>
  <script src="js/brigl.js"></script>
  <script src="js/brigl_view.js"></script>
  
  <script>
   var builder;
   var briglv_container;
   var cur_step;
   var have_model;
   var logarea;
   var max_step;
   var model;
   
   function init(){
       if ( ! Detector.webgl ) { alert("no webgl"); return; }

       have_model = false;
       max_step = 0;
       
       model = new BRIGLV.Model();
       briglv_container = new BRIGLV.Container(document.getElementById("container"));
       
       logarea = document.getElementById("log");
       BRIGL.log = function(msg){
  	   logarea.textContent = "BRIGL: " + msg;
       }
       BRIGLV.log = function(msg){
  	   logarea.textContent = "BRIGL-View: " + msg;
       }
   }

   function handleError(msg)
   {
       alert("Error: " + msg);
   }

   function handleFile(event){
       var input = event.target;
       logarea.value = ""
       
       var reader = new FileReader();
       reader.onload = function(){
	   model.reset();
	   model.loadModel(reader.result,
			   {},
			   function(){
			       cur_step = max_step = model.getMaxStep(0);
			       briglv_container.setModel(model.getMeshs(0, max_step), true);
			       have_model = true;
			   },
			   handleError);
       };
       reader.readAsText(input.files[0]);       
   }

   function incStep(delta){
       console.log("incStep " + delta);
       
       cur_step += delta;
       if(cur_step < 0){
	   cur_step = 0;
       }
       if(cur_step > max_step){
	   cur_step = max_step;
       }
       briglv_container.setModel(model.getMeshs(0, cur_step), true);       
   }
  </script>

  <body onload="init();">
    <p>Select A File <input type="file" id="input" onchange="handleFile(event)"></p>
    <p id="log">No Errors</p>
    <div id="container"></div>
    <p onclick="incStep(1)">up</p>
    <p onclick="incStep(-1)">down</p>
  </body>
</html>
